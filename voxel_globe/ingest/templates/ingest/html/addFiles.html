{% extends "main/base.html" %}
{% load staticfiles %}

{% block title %}Voxel Globe - Add files{% endblock %}

{% block includes %}

<link rel="stylesheet" href="{% static 'fileUpload/css/style.css' %}">
<link rel="stylesheet" href="{% static 'fileUpload/css/jquery.fileupload.css' %}">
<link rel="stylesheet" href="{% static 'fileUpload/css/jquery.fileupload-ui.css' %}">

<script src="{% static 'fileUpload/js/jquery.fileupload.js' %}"></script>
<script src="{% static 'fileUpload/js/jquery.fileupload-process.js' %}"></script>
<script src="{% static 'ingest/js/addFiles.js' %}"></script>

<style>

.uploadEntry {
  display: block;
  vertical-align: top;
}
.pendingUpload {
  list-style-image: url({% static 'icons/' %}upload_pending.png);
}

</style>
{% endblock %}

{% block globalfunctions %}
// Global functions defined outside of the jquery document ready function
// can be put here.

var pendingIcon = "{% static 'icons/' %}" + "upload_pending.png";
var progressIcon = "{% static 'icons/' %}" + "upload_progress.png";
var successIcon = "{% static 'icons/' %}" + "upload_success.png";
var failIcon = "{% static 'icons/' %}" + "upload_fail.png";
var url = '{% url "ingest:uploadEndpoint" %}';

{% endblock %}

{% block javascript %}

{% endblock %}

{% block pageTitle %}<h2>Add Files</h2> {% endblock %}

{% block content %}
<div id="mainContainer" class="main-content">

  <h1>Add files for {{ uploadSession.name }}</h1>

  <div class="horizontal-scroll-outer">
    <div class="horizontal-scroll-inner">
      Drag and drop image files onto this page to upload the images and files to
      the server.
      <p>
        <form action="{% url "ingest:uploadEndpoint" %}" 
            name="filedropform" method="post" enctype="multipart/form-data">
          {% csrf_token %}
            <input type="hidden" name="uploadSession" value="{{ uploadSession.id }}" />
            <input type="hidden" name="directory" value="{{ directory.id }}" />
            <input type="hidden" name="testFile" value="{{ testFile.id }}" />
            <input id="fileupload" type="file" name="filedrop" style="display:none" multiple>
        </form>
        
        <form action="{% url "ingest:ingestFolder" %}" name="ingestfolder" method="post">
          {% csrf_token %}
          <input type="hidden" name="uploadSession" value="{{ uploadSession.id }}" />
        </form>
       
        <button id="fakeUpload" class="ingest-button">
          Select files...
        </button>

        <div style="display:inline-block; width:50px;"> </div>

        <button id="doIngest" class="ingest-button">
          Upload Selected Files
        </button>

        <!--
          A temporary button that aborts the current upload, used in debugging
          upload failures. To reimplement the button: 
            1. uncomment this HTML code
            2. uncomment its listener in addFiles.js
            3. delete the lines in the onFail() function that cause it to exit
            if the error it encountered was upload abortion.

        <button id="tempAbort" class="ingest-button">
          Abort!
        </button>-->
        
        <button id="clearButton" class="ingest-button">
          Clear Selected Files
        </button>

        <div style="display:inline-block; width:50px;"> </div>

        <button id="processButton" class="ingest-button">
          Process Uploaded Files
        </button>
        
      </p>

      <h3>Files Selected for Upload</h3>
      <div id="selectedImages" style="margin: 15px 0px; padding: 0px;"></div>

    </div> <!-- .horizontal-scroll-inner -->
  </div> <!-- .horizontal-scroll-outer -->
</div> <!-- .main-content -->

<div id="debugInfo">
</div>
{% endblock %}
