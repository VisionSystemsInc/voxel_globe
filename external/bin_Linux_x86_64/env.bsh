#!/bin/bash

source $(dirname ${BASH_SOURCE[0]})/base.bsh
export VIP_LOCAL_SETTINGS=${VIP_LOCAL_SETTINGS-${VIP_PROJECT_ROOT}/local_vip.env}

if [ -e "${VIP_LOCAL_SETTINGS}" ]; then 
  source ${VIP_LOCAL_SETTINGS}
fi

export VIP_WRAP_SCRIPT=${VIP_WRAP_SCRIPT-${VIP_PROJECT_ROOT}/_wrap.bsh}

VIP_INSTALL_DIR__TEMP=${VIP_INSTALL_DIR-$(dirname ${BASH_SOURCE[0]})}
if [ ! -e ${VIP_INSTALL_DIR__TEMP} ]; then mkdir -p ${VIP_INSTALL_DIR__TEMP}; fi
export VIP_INSTALL_DIR=${VIP_INSTALL_DIR-$(cd ${VIP_INSTALL_DIR__TEMP}; pwd)}

export VIP_SRC_DIR=${VIP_SRC_DIR-${VIP_INSTALL_DIR}/../src}
export VIP_RPMSRC_DIR=${VIP_RPMSRC_DIR-${VIP_SRC_DIR}}
export VIP_RPMDB_DIR=${VIP_RPMDB_DIR-${VIP_RPMSRC_DIR}/db}
export VIP_INIT_DIR=${VIP_INIT_DIR-${VIP_INSTALL_DIR}/etc/init.d}
export VIP_OS=${VIP_OS-`uname -s`}
export VIP_ARCH=${VIP_ARCH-`uname -m`}

#export VIP_TEMP_DIR=${VIP_TMP_DIR-/tmp}
export VIP_TEMP_DIR=${VIP_TMP_DIR-/dev/shm}

#Setup directory stucture to be used by common.inc spec files and everything else
export VIP_PREFIX_BASE=${VIP_PREFIX_BASE-${VIP_PREFIX_BASE-/}}
export VIP_EXECPREFIX_BASE=${VIP_EXECPREFIX_BASE-${VIP_PREFIX_BASE}}
if [ "${VIP_PREFIX_BASE}" == "/" ]
then
  VIP_CAT_PREFIX_BASE=""
else
  VIP_CAT_PREFIX_BASE="${VIP_PREFIX_BASE}"
fi
export VIP_BINDIR_BASE=${VIP_BINDIR_BASE-${VIP_CAT_PREFIX_BASE}/bin}
export VIP_SBINDIR_BASE=${VIP_SBINDIR_BASE-${VIP_CAT_PREFIX_BASE}/bin}
export VIP_LIBDIR_BASE=${VIP_LIBDIR_BASE-${VIP_CAT_PREFIX_BASE}/lib}
export VIP_LIBEXECDIR_BASE=${VIP_LIBEXECDIR_BASE-${VIP_CAT_PREFIX_BASE}/libexec}
export VIP_SYSCONFDIR_BASE=${VIP_SYSCONFDIR_BASE-${VIP_CAT_PREFIX_BASE}/conf}
export VIP_DATADIR_BASE=${VIP_DATADIR_BASE-${VIP_CAT_PREFIX_BASE}/share}
export VIP_INCLUDEDIR_BASE=${VIP_INCLUDEDIR_BASE-${VIP_CAT_PREFIX_BASE}/include}
export VIP_LOCALSTATEDIR_BASE=${VIP_LOCALSTATEDIR_BASE-${VIP_CAT_PREFIX_BASE}/var}
export VIP_MANDIR_BASE=${VIP_MANDIR_BASE-${VIP_DATADIR_BASE}/man}
export VIP_DOCDIR_BASE=${VIP_DOCDIR_BASE-${VIP_DATADIR_BASE}/doc}
export VIP_INFODIR_BASE=${VIP_INFODIR_BASE-${VIP_DATADIR_BASE}/info}
export VIP_SHAREDSTATEDIR_BASE=${VIP_SHAREDSTATEDIR_BASE-${VIP_DATADIR_BASE}/com}
export VIP_ROAMDIR_BASE=${VIP_ROAMDIR_BASE-${VIP_CAT_PREFIX_BASE}/roam}

export VIP_PREFIX=${VIP_PREFIX-${VIP_INSTALL_DIR}${VIP_CAT_PREFIX_BASE}}
export VIP_EXECPREFIX=${VIP_EXECPREFIX-${VIP_INSTALL_DIR}${VIP_EXECPREFIX_BASE}}
export VIP_BINDIR=${VIP_BINDIR-${VIP_INSTALL_DIR}${VIP_BINDIR_BASE}}
export VIP_SBINDIR=${VIP_SBINDIR-${VIP_INSTALL_DIR}${VIP_SBINDIR_BASE}}
export VIP_LIBDIR=${VIP_LIBDIR-${VIP_INSTALL_DIR}${VIP_LIBDIR_BASE}}
export VIP_LIBEXECDIR=${VIP_LIBEXECDIR-${VIP_INSTALL_DIR}${VIP_LIBEXECDIR_BASE}}
export VIP_SYSCONFDIR=${VIP_SYSCONFDIR-${VIP_INSTALL_DIR}${VIP_SYSCONFDIR_BASE}}
export VIP_DATADIR=${VIP_DATADIR-${VIP_INSTALL_DIR}${VIP_DATADIR_BASE}}
export VIP_INCLUDEDIR=${VIP_INCLUDEDIR-${VIP_INSTALL_DIR}${VIP_INCLUDEDIR_BASE}}
export VIP_LOCALSTATEDIR=${VIP_LOCALSTATEDIR-${VIP_INSTALL_DIR}${VIP_LOCALSTATEDIR_BASE}}
export VIP_MANDIR=${VIP_MANDIR-${VIP_INSTALL_DIR}${VIP_MANDIR_BASE}}
export VIP_DOCDIR=${VIP_DOCDIR-${VIP_INSTALL_DIR}${VIP_DOCDIR_BASE}}
export VIP_INFODIR=${VIP_INFODIR-${VIP_INSTALL_DIR}${VIP_INFODIR_BASE}}
export VIP_SHAREDSTATEDIR=${VIP_SHAREDSTATEDIR-${VIP_INSTALL_DIR}${VIP_SHAREDSTATEDIR_BASE}}

export VIP_ROAM_DIR=${VIP_ROAM_DIR-${VIP_INSTALL_DIR}${VIP_ROAMDIR_BASE}}

export VIP_PID_DIR=${VIP_PID_DIR-${VIP_LOCALSTATEDIR}/run}
export VIP_DAEMON_HOME_DIR=${VIP_DAEMON_HOME_DIR-${VIP_LOCALSTATEDIR}/lib}

##### VXL var #####
export VIP_VXL_DIR=${VIP_VXL_DIR-${VIP_INSTALL_DIR}}
export VIP_VXL_PYTHON_DIR=${VIP_VXL_PYTHON_DIR-${VIP_VXL_DIR}/lib/python2.7/site-packages/vxl}
export VIP_VXL_BIN_DIR=${VIP_VXL_BIN_DIR-${VIP_VXL_DIR}/bin}
export VIP_VXL_SHARE_DIR=${VIP_VXL_SHARE_DIR-${VIP_VXL_DIR}/share}

#export VIP_CMAKE_PLATFORM=${VIP_CMAKE_PLATFORM-"Eclipse CDT4 - Unix Makefiles"}
export VIP_VXL_MAKE_COMMAND=${VIP_VXL_MAKE_COMMAND-"make"}
export VIP_CMAKE_PLATFORM=${VIP_CMAKE_PLATFORM-"Unix Makefiles"}
#VIP_CMAKE_ECLIPSE - set in local env if not in path
export VIP_OPENCL_INCLUDE_PATH=${VIP_OPENCL_INCLUDE_PATH-/usr/local/cuda/include}
export VIP_OPENCL_LIBRARY_PATH=${VIP_OPENCL_LIBRARY_PATH-/usr/local/cuda/lib64}
#export VIP_OPENCL_LIBRARY=${VIP_OPENCL_LIBRARY-${VIP_OPENCL_LIBRARY_PATH}/libOpenCL.so}
export VIP_OPENCL_LIBRARY_NAME=${VIP_OPENCL_LIBRARY_NAME-OpenCL}
export VIP_OPENCL_LIBRARY_FLAGS=${VIP_OPENCL_LIBRARY_FLAGS--L${VIP_OPENCL_LIBRARY_PATH} -l${VIP_OPENCL_LIBRARY_NAME}}

##### PYTHON var #####
export VIP_PYTHON_DIR=${VIP_PYTHON_DIR-${VIP_INSTALL_DIR}}
export VIP_PYTHON_INCLUDE_DIR=${VIP_PYTHON_INCLUDE_DIR-${VIP_INCLUDEDIR}/python2.7}
export VIP_PYTHON_LIBRARY=${VIP_PYTHON_LIBRARY-${VIP_LIBDIR}/libpython2.7.so}
export VIP_PYTHON_EXECUTABLE=${VIP_PYTHON_EXECUTABLE-${VIP_PYTHON_DIR}/roam/python}
export VIP_NOTEBOOK_DAEMON_USER=${VIP_NOTEBOOK_DAEMON_USER-${SUDO_USER-`stat -c %U $0`}}
export VIP_NOTEBOOK_DAEMON_GROUP=${VIP_NOTEBOOK_DAEMON_GROUP-`stat -c %G $0`}

# export VIP_NOTEBOOK_RUN_DIR=${VIP_NOTEBOOK_RUN_DIR-`eval echo ~${VIP_NOTEBOOK_USER}/notebook`}

##### GEODJANGO var #####

export VIP_DJANGO_PROJ_LIB=${VIP_DJANGO_PROJ_LIB-${VIP_DATADIR}/proj}
export VIP_DJANGO_GDAL_LIBRARY_PATH=${VIP_DJANGO_GDAL_LIBRARY_PATH-${VIP_LIBDIR}/libgdal.so}
export VIP_DJANGO_GEOS_LIBRARY_PATH=${VIP_DJANGO_GEOS_LIBRARY_PATH-${VIP_LIBDIR}/libgeos_c.so}
export VIP_DJANGO_GDAL_DATA=${VIP_DJANGO_GDAL_DATA-${VIP_DATADIR}/gdal}

##### POSTGRESQL var #####
export VIP_POSTGRESQL_LOCALE=${VIP_POSTGRESQL_LOCALE-en_US.UTF-8}

##### CELERY vars #####
export VIP_VISUALSFM_EXE=${VIP_VISUALSFM_EXE-visualsfm}

##### RABITMQ vars ##### 
export VIP_RABBITMQ_DIR=${VIP_RABBITMQ_DIR-${VIP_INSTALL_DIR}}
export VIP_RABBITMQ_ERLANG_HOME=${VIP_RABBITMQ_ERLANG_HOME-${VIP_INSTALL_DIR}}

export VIP_RABBITMQ_DAEMON=${VIP_RABBITMQ_DAEMON-epmd}

export VIP_NUMBER_CORES=${VIP_NUMBER_CORES-`nproc`}

##### Apache HTTPD vars ##### 
export VIP_HTTPD_SERVERROOT_BASE=${VIP_HTTPD_SERVERROOT_BASE-${VIP_LIBDIR_BASE}/httpd}
export VIP_HTTPD_DIR=${VIP_HTTPD_DIR-${VIP_INSTALL_DIR}${VIP_HTTPD_SERVERROOT_BASE}}

# *********** NON-VIP Section. There can affect ANYTHING ***********
# These parameters are not protected by the VIP Prefix, and thus
# Affect many application, but hopefully in a good way :)

# Load common parameters used in Windows too
source ${VIP_PROJECT_ROOT}/load_bat ${VIP_PROJECT_ROOT}/common.bat

# Different than windows, so can't be in common :(
export VIP_VXL_BUILD_LIB_DIR=${VIP_VXL_BUILD_LIB_DIR-${VIP_VXL_BUILD_DIR}/${VIP_VXL_BUILD_TYPE}/lib}
export VIP_VXL_BUILD_BIN_DIR=${VIP_VXL_BUILD_BIN_DIR-${VIP_VXL_BUILD_DIR}/${VIP_VXL_BUILD_TYPE}/bin}
export VIP_PYTHONPATH=${VIP_PYTHONPATH:+${VIP_PYTHONPATH}:}${VIP_VXL_PYTHON_DIR}:${VIP_VSI_DIR}/python

export GEOGRAPHICLIB_DATA=${GEOGRAPHICLIB_DATA-${VIP_DATADIR}/GeographicLib}

export PYTHONPATH="${VIP_PYTHONPATH}${PYTHONPATH:+:${PYTHONPATH}}"

export PATH="${VIP_ROAM_DIR}:${VIP_VSI_DIR}/linux:${PATH:+:${PATH}}"
